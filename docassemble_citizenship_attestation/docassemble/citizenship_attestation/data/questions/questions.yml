---
metadata:
  description: |
    Citizenship attestation
  authors:
    - name:  
      organization: None
  revision_date: 2015-08-29
---
include:
  - basic-questions.yml
---
imports:
  - datetime
---
objects:
  - attestation_recipient: Individual
---
code: |
  attestation_recipient.name.first = 'Jonathan'
  attestation_recipient.name.last  = 'Pyle'
  attestation_recipient.email      = 'jpyle@philalegal.org'
---
mandatory: True
code: |
  if user.is_citizen and user_is_willing_to_sign_citizenship_attestation and user.signature_verified and ok_to_submit_attestation_form:
    need(attestation_submitted)
  else:
    need(form_not_appropriate)
---
question: |
  Would you like a copy of the citizenship attestation to be e-mailed to you?
yesno: user_wants_copy_emailed
---
question: |
  I am a citizen of the United States.
signature: user.signature
need: user_understands_how_to_use_signature_feature
under: |
  ${ user.name }
---
sets: success_sending_attestation
code: |
  to_recipients = []
  bcc_recipients = None
  if user_wants_copy_emailed:
    to_recipients.append(user)
    bcc_recipients = [attestation_recipient]
  else:
    to_recipients.append(attestation_recipient)
  success_sending_attestation = send_email(to=to_recipients, bcc=bcc_recipients, body="The citizenship attestation for " + str(user.name) + " is attached", subject="Citizenship attestation for " + str(user.name), attachments=[user.signature])
---
question: |
  % if success_sending_attestation:
    Thank you for submitting the citizenship attestation form.
  % else:
    We are sorry, but there was a problem submitting your citizenship attestation.
  % endif
subquestion: |
  % if not success_sending_attestation:
    Please contact us so that we can mail you a citizenship attestation form.
  % endif
buttons:
  - Exit: exit
  - Restart: restart
sets: attestation_submitted
---
question: |
  Are you willing to electronically sign a statement saying that you are a citizen?
subquestion: |
  If you say yes, you will be asked to sign your name electronically.  If you are using a computer, you can use your mouse or trackpad to write your signature.  If you are using a mobile device with a touch screen, you can use your finger to sign.  If you cannot sign your name this way, say "no" here.
yesno: user_is_willing_to_sign_citizenship_attestation
---
question: |
  A citizenship attestation form will not be submitted.
buttons:
  - Exit: exit
  - Restart: restart
sets: form_not_appropriate
---
question: |
  Would you like to submit the signed document?
subquestion: |
  The citizenship attestation is below.  Please review to make sure it is ok to submit.  If you would like to submit the document, press "Yes."
decoration: finishline
yesno: ok_to_submit_attestation_form
attachments:
  - name: Citizenship attestation of ${ user }
    content: |
      [BOLDCENTER] CITIZENSHIP ATTESTATION

      I am a citizen of the United States.

      [SKIPLINE]
      ${ user.signature.show(width='2in') }

      Name: ${ user }

      Date: ${ today() }
    filename: Citizenship_Attestation_${ space_to_underscore(user) }
    variable_name: citizenship_attestation
progress: 100
...
